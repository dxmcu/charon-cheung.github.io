<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content><meta name="keywords" content><meta name="author" content="Charon Cheung"><meta name="copyright" content="Charon Cheung"><title>If you wish for peace, prepare for war | 沉默杀手</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><script>var GLOBAL_CONFIG={root:"/",algolia:{appId:"RI90VLL69D",apiKey:"20c535e9a1424a7913210eb747d6e67b",indexName:"HexoBlog",hits:{per_page:10},languages:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}.",hits_stats:"${hits} results found in ${time} ms"}},localSearch:void 0,copy:{success:"Copy successfully",error:"Copy error",noSupport:"The browser does not support"}}</script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Charon Cheung</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">365</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">13</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">46</span></a></div></div></div><nav id="nav" style="background-image:url(https://live.staticflickr.com/65535/48055510011_577ff62eaf_b.jpg)"><div id="page-header"><span class="pull-left"><a id="site-name" href="/">沉默杀手</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">沉默杀手</div><div id="site-sub-title">If you wish for peace, prepare for war</div><div id="site-social-icons"><a class="social-icon" href="https://github.com/charon-cheung"><i class="fa-github fa"></i></a><a class="social-icon search"><i class="fa fa-search"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/13/激光SLAM/Cartographer/(二) 参数配置/">(二) 参数配置</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/激光SLAM/">激光SLAM</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/激光SLAM/Cartographer/">Cartographer</a></span><div class="content"><p>trajectory_build是前端的参数配置，分为2d和3d两个文件。pose_graph.lua为后端优化的具体参数配置。</p><p>scan和echoes分别是普通和多回波激光的数据帧，具体用什么可以在lua里面设置。</p><p>num_laser_scans: 话题 sensor_msgs/LaserScan 的数量<br>num_multi_echo_laser_scans: 话题 sensor_msgs/MultiEchoLaserScan 的数量<br>num_point_clouds: 话题 sensor_msgs/PointCloud 的数量</p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/11/Linux基础/Linux的启动过程/">Linux的启动过程</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Linux基础/">Linux基础</a></span><div class="content"><p>几个重要文件的启动顺序：</p><ol><li><p>通过/boot/vm进行启动 vmlinuz</p></li><li><p>init /etc/inittab</p></li><li><p>启动相应的脚本，并且打开终端</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rc.sysinit</span><br><span class="line"></span><br><span class="line">rc.d(里面的脚本)</span><br><span class="line"></span><br><span class="line">rc.local</span><br></pre></td></tr></table></figure></li><li><p>启动login登录界面</p></li><li><p>登录，此时执行sh脚本的顺序，每次登录的时候都会完全执行的</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/etc/profile.d/file</span><br><span class="line"></span><br><span class="line">/etc/profile</span><br><span class="line"></span><br><span class="line">/etc/bashrc</span><br><span class="line"></span><br><span class="line">/root/.bashrc</span><br><span class="line"></span><br><span class="line">/root/.bash_profile</span><br></pre></td></tr></table></figure></li></ol><p>这里就清楚了，如果不登录还要加载环境变量，就只能把环境变量放到<code>rc.local</code>里</p><p>添加开机启动项： <code>sudo vim /etc/profile.d/apps-bin-path.sh</code>， 在其中放入可执行文件</p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/11/C++/C++  基础/static关键字/">static关键字</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/C/">C++</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/C/C-基础/">C++ 基础</a></span><div class="content"><p>函数在栈上分配的空间在此函数执行结束时会释放掉，这样就产生了一个问题: <font color="blue"><font size="3">如果想将函数中此变量的值保存至下一次调用时，如何实现？ </font></font>最容易想到的方法是定义为全局的变量，但这样最明显的缺点是<em>破坏了此变量的访问范围</em>(使得在此函数中定义的变量，不仅仅只受此函数控制). 当程序想要使用全局变量的时候应该先考虑使用 static</p><p>全局变量和静态变量的存储都放在内存的<strong>全局区</strong>，初始化的全局变量和静态变量在一块区域， 未初始化的全局变量和未初始化的静态变量在相邻的另一块区域</p><h3 id="全局变量和全局静态变量的区别"><a href="#全局变量和全局静态变量的区别" class="headerlink" title="全局变量和全局静态变量的区别"></a>全局变量和全局静态变量的区别</h3><ul><li><p>全局变量默认是有外部链接性的，作用域是整个工程，在一个文件内定义的全局变量，在另一个文件中，可以通过<code>extern</code>全局变量名的声明，就可以使用全局变量。</p></li><li><p>全局静态变量是显式用 static 修饰的全局变量，作用域仅在声明此变量的文件，其他的文件即使用 extern 声明也不能使用。这样即使两个不同的源文件都定义了相同名字的static全局变量，它们也是不同的变量。</p></li></ul><p>静态局部变量有以下特点：</p><ol><li>该变量在全局数据区分配内存；</li><li>静态局部变量在程序执行到该对象的声明处时被首次初始化，即以后的函数调用不再进行初始化；</li><li>静态局部变量一般在声明处初始化，如果没有显式初始化，会被程序自动初始化为 0；</li><li>始终驻留在全局数据区，直到程序运行结束。但其作用域为局部作用域，当定义它的函数或语句块结束时，其作用域随之结束。</li><li>它和全局变量的区别在于全局变量对所有的函数都是可见的，而static局部变量只对定义自己的函数体始终可见。</li></ol><p>把局部变量改变为static变量后是改变了它的存储方式和生存期。把全局变量改变为static变量是改变了它的作用域，限制了它的使用范围。</p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/10/ROS/ROS机器人/思岚雷达的使用/">思岚雷达的使用</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-10</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS机器人/">ROS机器人</a></span><div class="content"><p>我手上有思岚A1和A2雷达，使用很简单，按照<a href="https://www.ncnynl.com/archives/201611/1100.html" target="_blank" rel="noopener">创客智造——ROS中使用思岚A1激光雷达</a>一步步进行就可以</p><p>不同的是A1插上电源就开始转，A2是运行launch后才转</p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/09/ROS/ROS机器人/urdf建模/">urdf建模</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-09</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS机器人/">ROS机器人</a></span><div class="content"><p>在一个package中新建文件夹，第一个文件夹为urdf，用来放置模型文件。第二个文件夹叫做meshes，用来放置外观纹理，一般是通过三维软件建模完成后，导出并放置在meshes中，第三个为launch文件夹。第四个是config文件夹，功能包的配置文件以及rviz的显示配置文件。</p><p>我们要准备这样的launch文件：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span>                                               </span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"robot_description"</span> <span class="attr">textfile</span>=<span class="string">"$(find robot_description)/urdf/robot.urdf"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置GUI参数，显示关节控制插件，配合下面的joint_state_publisher使用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"use_gui"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 发布机器人的关节状态  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 发布tf，根据关节状态，创建tf关系，并发布到tf tree中  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure><p>一个简单的模型，就是一个底盘带一个轮子：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"hlhp-robot"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"Black"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.15 0.15 0.15 1"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"Blue"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0 0 0.8 1"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"0.5 0.3 0.01"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"Black"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"left_front_wheel_link"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span>=<span class="string">"1.5707 0 0"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"0.1125"</span> <span class="attr">length</span>=<span class="string">"0.064"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"Blue"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"left_front_joint"</span> <span class="attr">type</span>=<span class="string">"continuous"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.1375 0.182 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"left_front_wheel_link"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 1 0"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure><p>有时创建URDF模型在rviz中显示时，可以显示模型形状，但不显示颜色，rviz中显示<font color="orange"> <font size="3">No transform from [base_link] to [map] </font></font>。 rviz默认Fixed Frame为<code>map</code>，而我的模型中没有map，将Fixed Frame改为<code>base_link</code>，重启一遍后，模型有了颜色。 依次类推，画出另外三个轮子.</p><p>使用<code>check_urdf robot.urdf</code>可以检查语法,但是偶尔也有漏掉错误的时候.</p><p>第一行的xml版本声明,开头不能有空格, 也不能加注释. <strong>在urdf文件中不能加中文注释</strong></p><h3 id="joint-state-publisher-和-robot-state-publisher"><a href="#joint-state-publisher-和-robot-state-publisher" class="headerlink" title="joint_state_publisher 和 robot_state_publisher"></a>joint_state_publisher 和 robot_state_publisher</h3><p><strong>joint_state_publisher</strong>节点读取<code>robot_description</code>参数,这个就是我们的urdf文件.</p><p><code>use_gui</code>参数,布尔类型,默认false,决定是否显示GUI界面. 这个小工具把所有joint做成slider形式,供用户测试,对continuous的joint,slider范围是-π到π</p><p>发布话题<code>/joint_states</code>, 消息类型<code>sensor_msgs/JointState</code>,可以echo查看</p><p><strong>robot_state_publisher</strong>订阅话题<code>/joint_states</code>, tf变换也是它发布的,它有一个参数<code>use_tf_static</code>,用于决定是否使用<code>tf_static</code> latched 静态变换的广播,而这个参数默认true.<br><img src="https://i.loli.net/2020/03/11/DTZpH8avxUdXw26.png" alt="robot_state_publisher.png"></p><p>一般写成launch形式:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"robot_description"</span> <span class="attr">textfile</span>=<span class="string">"$(find robot_description)/urdf/robot.urdf"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"use_gui"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure><p>启动launch，在rviz中加载<code>RobotModel</code>，如果没有<code>map</code>坐标系，就把全局坐标系改成<code>base_link</code>坐标系，会显示下面画面：<br><img src="https://i.loli.net/2020/03/10/1DIVeEKWRsSgZd6.png" alt="urdf.png"></p><p>现在可以启动完整的机器人程序了，有了map坐标系，也就有了<code>map-&gt;base_link</code>转换，现在移动机器人，rviz里的模型就会跟着移动了。<br><img src="https://i.loli.net/2020/03/11/nWJHthyRDTr8LKY.png" alt="机器人模型.png"></p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>rviz里没有显示机器人的模型，发现终端有这样的错误：<br><img src="https://i.loli.net/2020/04/21/QglJ2yY4AS81WeV.png" alt="本机rviz加载urdf出错"></p><p>参考：<br><a href="https://zhuanlan.zhihu.com/p/67550381" target="_blank" rel="noopener">古月居的urdf教程</a><br><a href="https://blog.csdn.net/hitgavin/article/details/51997379" target="_blank" rel="noopener">urdf文件编码导致的缺少tf变换</a></p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/09/SLAM工具/PCL点云/ROS中的几个点云工具/">ROS中的几个点云工具</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-09</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM工具/">SLAM工具</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM工具/PCL点云/">PCL点云</a></span><div class="content"><h3 id="pointcloud-to-laserscan包"><a href="#pointcloud-to-laserscan包" class="headerlink" title="pointcloud_to_laserscan包"></a>pointcloud_to_laserscan包</h3><p>将3D点云转换为2D的雷达scan, 最适用于把Kinect相机用作雷达，再使用2D算法。<a href="http://wiki.ros.org/pointcloud_to_laserscan" target="_blank" rel="noopener">详细使用</a></p><h3 id="depthimage-to-laserscan"><a href="#depthimage-to-laserscan" class="headerlink" title="depthimage_to_laserscan"></a>depthimage_to_laserscan</h3><p>如果想从RGBD相机创建虚拟的雷达scan，这个包的效果更好，它直接处理图像数据而不是点云。<br><a href="http://wiki.ros.org/depthimage_to_laserscan" target="_blank" rel="noopener">详细使用</a></p><p>使用Kinect的一个方案是把点云或深度图降维生成线激光，本质上是当成2D激光雷达，在平坦地面环境用。还是用gmapping、hector SLAM、cartographer等手段建图，而局部路径规划用动态窗算法或者teb算法都可以。这时候可以用这个包</p><h3 id="pcl-ros包"><a href="#pcl-ros包" class="headerlink" title="pcl_ros包"></a>pcl_ros包</h3><p>这个包的工具如下：<br><img src="https://i.loli.net/2020/03/09/UrXntZwKoOFR9vd.png" alt="pcl_ros包.png"></p><p>如果想获得雷达的点云数据，可以发布<code>PointCloud2</code>类型的话题，同时用<code>rosbag record</code>录制得到bag文件，然后使用<code>pcl_ros</code>包中的<code>bag_to_pcd</code>得到pcd点云文件，用法：<code>rosrun pcl_ros bag_to_pcd input.bag topic output_directory</code>，过程：<br><img src="https://i.loli.net/2020/03/09/nZbwL31r7tRAF4N.png" alt="转换过程.png"></p><p>注意输出是个目录，因为<strong>bag文件的消息数量就是生成的pcd文件数量</strong>，bag文件的消息数量可以用<code>rosbag info</code>查看<br><img src="https://i.loli.net/2020/03/09/EZ8yGRJhl2Bj9nN.png" alt="rosbag info.png"></p><p>可以用<code>pcl_viewer</code>工具查看pcd，<strong>然后就是点云拼接了。</strong> 如果只有雷达<code>scan</code>数据，那只能先转为点云数据，才能转为pcd文件</p><p>参考：<br><a href="https://blog.csdn.net/Mr_yangsir/article/details/94559945" target="_blank" rel="noopener">ROS中解析bag包中的点云文件到pcd格式</a><br><a href="https://www.cnblogs.com/banrixianxin/p/6378789.html" target="_blank" rel="noopener">激光雷达bag文件播放和转PCD文件</a></p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/04/SLAM工具/PCL点云/(二) ICP算法/">(二) ICP算法</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-04</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM工具/">SLAM工具</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM工具/PCL点云/">PCL点云</a></span><div class="content"><p>ICP算法采用最小二乘估计计算变换矩阵，原理简单且具有较好的精度，但是由于采用了迭代计算，导致算法计算速度较慢，而且采用ICP进行配准计算时，其对待配准点云的初始位置有一定要求，若所选初始位置不合理，则会导致算法陷入局部最优。</p><p>IterativeClosestPoint类提供了标准ICP算法的实现（The transformation is estimated based on SVD），算法迭代结束条件有如下几个:</p><ul><li>最大迭代次数： 最大迭代次数。 <code>setMaximumIterations (100)</code></li><li>两次变化矩阵之间的差值：前一个变换矩阵和当前变换矩阵的差异小于阈值时，就认为已经收敛了。 <code>setTransformationEpsilon(1e-10)</code></li><li>均方误差（MSE）：均方误差和小于给定阈值， 停止迭代。 <code>setEuclideanFitnessEpsilon(0.01)</code></li></ul><p><code>align</code>函数是配准，<strong>在使用之前至少给定上面三个条件</strong>，还有<code>setMaxCorrespondenceDistance</code>等其他函数。PCL的ICP里的transformation estimation就是基于SVD分解实现的。</p><p>如果从一个好的<strong>初始猜想变换矩阵</strong>开始迭代，那么算法将会在比较少的迭代之后就收敛，配准结果也较好，当像我们这里没有指定初始guess时，就默认使用单位阵<code>Matrix4::Identity()</code></p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/03/SLAM工具/PCL点云/(三)杂项/">(二) 杂项</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM工具/">SLAM工具</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM工具/PCL点云/">PCL点云</a></span><div class="content"><h3 id="计时"><a href="#计时" class="headerlink" title="计时"></a>计时</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pcl::console::TicToc time;</span><br><span class="line">time.tic ();</span><br><span class="line"><span class="comment">//需要记录执行多长时间的代码</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt;time.toc () &lt;&lt; <span class="string">" ms :&lt;&lt; endl;</span></span><br></pre></td></tr></table></figure><h3 id="日志输出"><a href="#日志输出" class="headerlink" title="日志输出"></a>日志输出</h3><p>同ROS类似，就是把ROS换成了PCL: PCL_DEBUG, PCL_INFO, PCL_WARN, PCL_ERROR</p><p>参考：<a href="http://pointclouds.org/documentation/tutorials/pcl_visualizer.php#pcl-visualizer" target="_blank" rel="noopener"></a></p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/02/激光SLAM/深蓝学院-激光SLAM理论与实践/第4章 前端配准I/">第4章 前端配准I</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-02</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/激光SLAM/">激光SLAM</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/激光SLAM/深蓝学院-激光SLAM理论与实践/">深蓝学院-激光SLAM理论与实践</a></span><div class="content"><p>前端匹配又叫帧间匹配</p><p>SLAM前端匹配，是构建方程的过程。后端优化是求解方程的过程。一个好的SLAM算法重点在前端。</p><ul><li>ICP：迭代最近点</li><li>PL-ICP：点到线的ICP</li><li>NICP：法向量的ICP</li><li>IMLS-ICP：implicit moving least square，隐式移动最小二乘</li></ul><p>四种方法，依次精度更高，计算量更大。</p><p><img src="https://i.loli.net/2020/03/02/JTq3rFOoXwU4Zlu.png" alt></p><h3 id="ICP"><a href="#ICP" class="headerlink" title="ICP"></a>ICP</h3><p>R,t就是相邻两帧激光对应的机器人位置的欧氏变换，以此类推，根据很多帧的点云，就能求出一系列的机器人位姿变换关系。<br>ICP有二维和三维。<br>由于两个点云对应同一个实体，那么理论上配准后的距离应该为0，由于误差的存在，我们要求距离的最小值。</p><p>对于已知对应点的情况(已知R)，我们可以求出解析解，而不必用迭代方法：<br><img src="https://i.loli.net/2020/03/02/A4yZXVaoPLjkuQT.png" alt></p><p>实际中不知道对应点匹配，不能直接算出R和t，要进行迭代计算：寻找对应点，根据对应点计算R,t；对点云转换再计算误差；不断迭代直至误差足够小。</p><p>ICP的一个明显缺陷：两帧激光点云数据中的点不可能表示的是空间中相同的位置。所以用点到点的距离作为误差方程势必会引入随机误差。</p><ul><li>依赖初始值，初始值不好时，迭代次数增加；对于较大的初始误差，可能会出现错误的迭代结果</li><li>ICP是一阶收敛，收敛速度慢。（所以会用kd-tree来加快搜索效率）</li><li>会有离群点及噪声</li></ul><p>所以原始的ICP太粗糙，不足以应用实践。</p><h3 id="PL-ICP"><a href="#PL-ICP" class="headerlink" title="PL-ICP"></a>PL-ICP</h3><p>这一段视频又讲的不好，对censi论文中的PL-ICP示意图讲解不到位，对红色和蓝色的点，同心圆没有说明，而且数学公式怀疑有问题，看的云里雾里。</p><p>Point to Line-ICP修改的是误差尺度，思想和之后的ICP类似。</p><p>雷达的激光点是对实际环境中曲面的离散采样。重要的不是激光点，而是曲面。最好的误差尺度为当前激光点到实际<br>曲面的距离；所以关键的问题在于如何恢复曲面</p><p>PL-ICP：用分段线性的方法（折线）来对实际曲面进行近似，从而定义当前帧激光点到曲面的距离</p><ol><li>ICP对点对点的距离作为误差，PL-ICP为点到线的距离作为误差；PL-ICP的误差形式更符号实际情况。</li><li>收敛速度不同，ICP为一阶收敛，PL-ICP为二阶收敛。</li><li>PL-ICP的求解精度高于ICP，特别是在结构化环境中。不适合室外</li><li>PL-ICP对初始值更敏感。不单独使用，其容易陷入局部循环。与里程计、CSM等一起使用，通常用里程计得到一个初始转换矩阵q0给到PL-ICP算法</li></ol><p>ros的csm包实现了ICP和PL-ICP算法。作者给出了一个该功能包的操作说明文件（csm_manual.pdf）。里面详细描述了各项配置参数的含义。其中sm/app文件夹中的sm0.c sm1.c sm2.c sm3.c 相当于是几个使用示例。 主要的算法实现是在csm/icp文件夹中的几个文件里。论文中的所有算法步骤完整的体现在了icp_loop.c文件中的icp_loop函数里。</p><h3 id="NICP"><a href="#NICP" class="headerlink" title="NICP"></a>NICP</h3><p>normal ICP，法向量ICP</p><p>旋转带入比较大的平移误差，但平移不会带来很大旋转误差</p></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/25/脚本/lua学习/">lua学习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/脚本/">脚本</a></span><div class="content"><p>从官网下载压缩包后，解压再执行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd lua-5.3.0</span><br><span class="line">make linux test</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p><code>lua -v</code>显示版本，接下来创建一个<code>test.lua</code>文件，代码如下:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"Hello World!"</span>)</span><br></pre></td></tr></table></figure><p>执行命令<code>lua test.lua</code>得到输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure></div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/37/">37</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image:url(https://live.staticflickr.com/65535/48055510011_577ff62eaf_b.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2020 By Charon Cheung</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/algolia.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"))</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>